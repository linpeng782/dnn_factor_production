# å‘½ä»¤è¡Œå‚æ•°è¯¦è§£ - æ–°æ‰‹æ•™ç¨‹

## ä»€ä¹ˆæ˜¯å‘½ä»¤è¡Œå‚æ•°ï¼Ÿ

å‘½ä»¤è¡Œå‚æ•°å°±æ˜¯åœ¨è¿è¡Œç¨‹åºæ—¶ï¼Œé€šè¿‡å‘½ä»¤è¡Œä¼ é€’ç»™ç¨‹åºçš„ä¿¡æ¯ã€‚

**å¯¹æ¯”**ï¼š

### æ—§æ–¹å¼ï¼ˆéœ€è¦ä¿®æ”¹ä»£ç ï¼‰
```python
# æ¯æ¬¡éƒ½è¦æ‰“å¼€æ–‡ä»¶ä¿®æ”¹è¿™äº›å€¼
dataset_end_date = "20251015"  # è¦æ”¹æ—¥æœŸå°±å¾—æ”¹è¿™é‡Œ
test_limit = 50                # è¦æ”¹æ•°é‡å°±å¾—æ”¹è¿™é‡Œ
```

### æ–°æ–¹å¼ï¼ˆå‘½ä»¤è¡Œå‚æ•°ï¼‰
```bash
# ä¸ç”¨æ”¹ä»£ç ï¼Œç›´æ¥åœ¨å‘½ä»¤è¡ŒæŒ‡å®š
python run_batch_factor_processing.py --date 20251015 --limit 50
```

---

## æ ¸å¿ƒæ¦‚å¿µï¼šå‚æ•°ç»„åˆ

**é‡è¦**ï¼šæ‰€æœ‰å‚æ•°éƒ½æ˜¯**å¯é€‰çš„**ï¼Œå¯ä»¥è‡ªç”±ç»„åˆï¼

### å‚æ•°åˆ—è¡¨

| å‚æ•° | ä½œç”¨ | é»˜è®¤å€¼ | å¿…éœ€ï¼Ÿ |
|------|------|--------|--------|
| `--date` | æŒ‡å®šå¤„ç†å“ªå¤©çš„æ•°æ® | ä»Šå¤© | âŒ |
| `--mode` | è¿è¡Œæ¨¡å¼ | `batch` | âŒ |
| `--stock` | è‚¡ç¥¨ä»£ç ï¼ˆsingleæ¨¡å¼ç”¨ï¼‰ | `000001.XSHE` | âŒ |
| `--workers` | çº¿ç¨‹æ•° | `4` | âŒ |
| `--limit` | é™åˆ¶å¤„ç†æ•°é‡ | `None`ï¼ˆå…¨éƒ¨ï¼‰ | âŒ |

---

## è¯¦ç»†ç¤ºä¾‹è®²è§£

### ç¤ºä¾‹1ï¼šæœ€ç®€å•çš„ç”¨æ³•
```bash
python run_batch_factor_processing.py
```

**è§£é‡Š**ï¼š
- æ²¡æœ‰ä»»ä½•å‚æ•°
- ä½¿ç”¨**ä»Šå¤©çš„æ—¥æœŸ**
- å¤„ç†**æ‰€æœ‰è‚¡ç¥¨**
- ä½¿ç”¨ **4ä¸ªçº¿ç¨‹**

**ç­‰åŒäº**ï¼š
```bash
python run_batch_factor_processing.py --date ä»Šå¤© --mode batch --workers 4 --limit å…¨éƒ¨
```

---

### ç¤ºä¾‹2ï¼šå¤„ç†æŒ‡å®šæ—¥æœŸ
```bash
python run_batch_factor_processing.py --date 20251015
```

**è§£é‡Š**ï¼š
- `--date 20251015`ï¼šå¤„ç† **2025å¹´10æœˆ15æ—¥** çš„æ•°æ®
- å…¶ä»–å‚æ•°ç”¨é»˜è®¤å€¼

**å®é™…æ•ˆæœ**ï¼š
- è¯»å–æ•°æ®ï¼š`/Users/didi/Data/dnn_model/raw/æ—¥çº¿åå¤æƒåŠå¸¸ç”¨æŒ‡æ ‡csv/`
- è¾“å‡ºåˆ°ï¼š`/Users/didi/Data/dnn_model/enhanced/enhanced_factors_csv_20251015/`
- å¤„ç†æ‰€æœ‰è‚¡ç¥¨

---

### ç¤ºä¾‹3ï¼šæµ‹è¯•æ¨¡å¼ï¼ˆ10åªè‚¡ç¥¨ï¼‰
```bash
python run_batch_factor_processing.py --limit 10
```

**è§£é‡Š**ï¼š
- `--limit 10`ï¼šåªå¤„ç† **å‰10åªè‚¡ç¥¨**
- ç”¨äºå¿«é€Ÿæµ‹è¯•ï¼Œä¸ç”¨ç­‰å¾ˆä¹…

**å®é™…æ•ˆæœ**ï¼š
- å¤„ç†ä»Šå¤©çš„æ•°æ®
- åªå¤„ç†å‰10åªè‚¡ç¥¨ï¼ˆä¸æ˜¯å…¨éƒ¨5000å¤šåªï¼‰
- å¤§çº¦5-10ç§’å°±å®Œæˆ

**ä¸ºä»€ä¹ˆè¦ç”¨ `--limit`ï¼Ÿ**
- âœ… å¿«é€Ÿæµ‹è¯•ä»£ç æ˜¯å¦æ­£å¸¸
- âœ… ä¸ç”¨ç­‰30åˆ†é’Ÿå¤„ç†å…¨éƒ¨è‚¡ç¥¨
- âœ… èŠ‚çœæ—¶é—´å’Œèµ„æº

---

### ç¤ºä¾‹4ï¼šæµ‹è¯•å•åªè‚¡ç¥¨
```bash
python run_batch_factor_processing.py --mode single --stock 000001.XSHE
```

**è§£é‡Š**ï¼š
- `--mode single`ï¼šåˆ‡æ¢åˆ°**å•è‚¡æµ‹è¯•æ¨¡å¼**
- `--stock 000001.XSHE`ï¼šæŒ‡å®šè‚¡ç¥¨ä»£ç ï¼ˆå¹³å®‰é“¶è¡Œï¼‰

**å®é™…æ•ˆæœ**ï¼š
- åªå¤„ç†å¹³å®‰é“¶è¡Œè¿™ä¸€åªè‚¡ç¥¨
- å¤§çº¦2-3ç§’å®Œæˆ
- ç”¨äºè°ƒè¯•æŸåªè‚¡ç¥¨çš„é—®é¢˜

**å…¶ä»–è‚¡ç¥¨ç¤ºä¾‹**ï¼š
```bash
# æµ‹è¯•è´µå·èŒ…å°
python run_batch_factor_processing.py --mode single --stock 600519.XSHG

# æµ‹è¯•æ‹›å•†é“¶è¡Œ
python run_batch_factor_processing.py --mode single --stock 600036.XSHG
```

---

### ç¤ºä¾‹5ï¼šé‡è¯•å¤±è´¥çš„è‚¡ç¥¨
```bash
python run_batch_factor_processing.py --mode retry
```

**è§£é‡Š**ï¼š
- `--mode retry`ï¼šé‡è¯•ä¹‹å‰å¤±è´¥çš„è‚¡ç¥¨

**ä½¿ç”¨åœºæ™¯**ï¼š
1. å…ˆè¿è¡Œæ‰¹é‡å¤„ç†ï¼š`python run_batch_factor_processing.py`
2. å‘ç°æœ‰3åªè‚¡ç¥¨å¤±è´¥
3. è¿è¡Œé‡è¯•ï¼š`python run_batch_factor_processing.py --mode retry`

**å®é™…æ•ˆæœ**ï¼š
- è¯»å–å¤±è´¥æ—¥å¿—ï¼š`log/failed_stocks_*.txt`
- åªå¤„ç†å¤±è´¥çš„è‚¡ç¥¨
- ä¸ä¼šé‡å¤å¤„ç†æˆåŠŸçš„è‚¡ç¥¨

---

### ç¤ºä¾‹6ï¼šé‡è¯•æŒ‡å®šæ—¥æœŸçš„å¤±è´¥è‚¡ç¥¨
```bash
python run_batch_factor_processing.py --date 20251015 --mode retry
```

**è§£é‡Š**ï¼š
- `--date 20251015`ï¼šæŒ‡å®šæ—¥æœŸ
- `--mode retry`ï¼šé‡è¯•æ¨¡å¼

**å®é™…æ•ˆæœ**ï¼š
- é‡è¯• 2025å¹´10æœˆ15æ—¥ å¤±è´¥çš„è‚¡ç¥¨
- è¯»å–ï¼š`log/failed_stocks_20251015.txt`

---

### ç¤ºä¾‹7ï¼šä½¿ç”¨æ›´å¤šçº¿ç¨‹
```bash
python run_batch_factor_processing.py --workers 8
```

**è§£é‡Š**ï¼š
- `--workers 8`ï¼šä½¿ç”¨ **8ä¸ªçº¿ç¨‹** å¹¶è¡Œå¤„ç†

**æ•ˆæœå¯¹æ¯”**ï¼š
- 4ä¸ªçº¿ç¨‹ï¼ˆé»˜è®¤ï¼‰ï¼šå¤„ç†5000åªè‚¡ç¥¨çº¦30åˆ†é’Ÿ
- 8ä¸ªçº¿ç¨‹ï¼šå¤„ç†5000åªè‚¡ç¥¨çº¦15åˆ†é’Ÿ

**æ³¨æ„**ï¼š
- çº¿ç¨‹å¤ªå¤šå¯èƒ½å¯¼è‡´ç±³ç­APIé™æµ
- å»ºè®®ï¼š4-8ä¸ªçº¿ç¨‹

---

### ç¤ºä¾‹8ï¼šç»„åˆä½¿ç”¨
```bash
python run_batch_factor_processing.py --date 20251010 --limit 50 --workers 8
```

**è§£é‡Š**ï¼š
- `--date 20251010`ï¼šå¤„ç†10æœˆ10æ—¥çš„æ•°æ®
- `--limit 50`ï¼šåªå¤„ç†50åªè‚¡ç¥¨
- `--workers 8`ï¼šä½¿ç”¨8ä¸ªçº¿ç¨‹

**å®é™…æ•ˆæœ**ï¼š
- å¤„ç†2025å¹´10æœˆ10æ—¥çš„æ•°æ®
- åªå¤„ç†å‰50åªè‚¡ç¥¨
- ä½¿ç”¨8ä¸ªçº¿ç¨‹å¹¶è¡Œ
- å¤§çº¦10ç§’å®Œæˆ

---

## å‚æ•°çš„é¡ºåºé‡è¦å—ï¼Ÿ

**ä¸é‡è¦ï¼** ä»¥ä¸‹éƒ½æ˜¯ä¸€æ ·çš„ï¼š

```bash
# æ–¹å¼1
python run_batch_factor_processing.py --date 20251015 --limit 10

# æ–¹å¼2
python run_batch_factor_processing.py --limit 10 --date 20251015

# æ–¹å¼3
python run_batch_factor_processing.py --limit 10 --workers 8 --date 20251015
```

---

## å¸¸è§é—®é¢˜

### Q1: `--limit 10` æ˜¯æµ‹è¯•å“ªå¤©çš„è‚¡ç¥¨ï¼Ÿ

**ç­”**ï¼šå–å†³äº `--date` å‚æ•°

```bash
# æµ‹è¯•ä»Šå¤©çš„å‰10åªè‚¡ç¥¨
python run_batch_factor_processing.py --limit 10

# æµ‹è¯•10æœˆ15æ—¥çš„å‰10åªè‚¡ç¥¨
python run_batch_factor_processing.py --date 20251015 --limit 10

# æµ‹è¯•10æœˆ10æ—¥çš„å‰10åªè‚¡ç¥¨
python run_batch_factor_processing.py --date 20251010 --limit 10
```

### Q2: å¦‚ä½•çŸ¥é“å¤„ç†äº†å“ªäº›è‚¡ç¥¨ï¼Ÿ

**ç­”**ï¼šæŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
tail -100 /Users/didi/Data/dnn_model/logs/factor_*.log

# æˆ–æŸ¥çœ‹è¾“å‡ºç›®å½•
ls /Users/didi/Data/dnn_model/enhanced/enhanced_factors_csv_20251015/
```

### Q3: å¦‚ä½•æŸ¥çœ‹å¤±è´¥çš„è‚¡ç¥¨ï¼Ÿ

**ç­”**ï¼šæŸ¥çœ‹å¤±è´¥æŠ¥å‘Š

```bash
# æŸ¥çœ‹æ±‡æ€»æŠ¥å‘Š
cat /Users/didi/dnn_model/factor_engineering/log/failed_summary_*.txt

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
cat /Users/didi/dnn_model/factor_engineering/log/failed_stocks_*.txt
```

### Q4: å‚æ•°å†™é”™äº†ä¼šæ€æ ·ï¼Ÿ

**ç­”**ï¼šç¨‹åºä¼šæç¤ºé”™è¯¯

```bash
# é”™è¯¯ç¤ºä¾‹
python run_batch_factor_processing.py --date 2025-10-15
# é”™è¯¯ï¼šæ—¥æœŸæ ¼å¼åº”è¯¥æ˜¯ 20251015ï¼Œä¸æ˜¯ 2025-10-15

python run_batch_factor_processing.py --mode test
# é”™è¯¯ï¼šmode åªèƒ½æ˜¯ batchã€single æˆ– retry
```

---

## å®æˆ˜æµç¨‹

### åœºæ™¯1ï¼šå¼€å‘æµ‹è¯•
```bash
# 1. å…ˆæµ‹è¯•1åªè‚¡ç¥¨
python run_batch_factor_processing.py --mode single --stock 000001.XSHE

# 2. æµ‹è¯•10åªè‚¡ç¥¨
python run_batch_factor_processing.py --limit 10

# 3. ç¡®è®¤æ— è¯¯åï¼Œå¤„ç†å…¨éƒ¨
python run_batch_factor_processing.py
```

### åœºæ™¯2ï¼šæ—¥å¸¸è¿è¡Œ
```bash
# æ¯å¤©å®šæ—¶è¿è¡Œï¼ˆcronä¼šè‡ªåŠ¨æ‰§è¡Œï¼‰
# æ— éœ€æ‰‹åŠ¨è¿è¡Œ
```

### åœºæ™¯3ï¼šè¡¥å……å†å²æ•°æ®
```bash
# è¡¥å……10æœˆ10æ—¥çš„æ•°æ®
python run_batch_factor_processing.py --date 20251010

# è¡¥å……10æœˆ11æ—¥çš„æ•°æ®
python run_batch_factor_processing.py --date 20251011

# è¡¥å……10æœˆ12æ—¥çš„æ•°æ®
python run_batch_factor_processing.py --date 20251012
```

### åœºæ™¯4ï¼šå¤„ç†å¤±è´¥é‡è¯•
```bash
# 1. è¿è¡Œæ‰¹é‡å¤„ç†
python run_batch_factor_processing.py --date 20251015

# 2. æŸ¥çœ‹å¤±è´¥æŠ¥å‘Š
cat log/failed_summary_20251015.txt

# 3. é‡è¯•å¤±è´¥çš„è‚¡ç¥¨
python run_batch_factor_processing.py --date 20251015 --mode retry
```

---

## æŸ¥çœ‹å¸®åŠ©

éšæ—¶å¯ä»¥æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ï¼š

```bash
python run_batch_factor_processing.py --help
```

è¾“å‡ºï¼š
```
usage: run_batch_factor_processing.py [-h] [--date DATE] 
                                      [--mode {batch,single,retry}]
                                      [--stock STOCK] [--workers WORKERS]
                                      [--limit LIMIT]

æ¯æ—¥å› å­å¤„ç†

options:
  -h, --help            show this help message and exit
  --date DATE           æ•°æ®æ—¥æœŸ(YYYYMMDD)ï¼Œé»˜è®¤ä»Šå¤©
  --mode {batch,single,retry}
                        è¿è¡Œæ¨¡å¼: batch=æ‰¹é‡å¤„ç†, single=å•è‚¡æµ‹è¯•, retry=é‡è¯•å¤±è´¥
  --stock STOCK         å•è‚¡æ¨¡å¼ä¸‹çš„è‚¡ç¥¨ä»£ç 
  --workers WORKERS     çº¿ç¨‹æ•°
  --limit LIMIT         é™åˆ¶è‚¡ç¥¨æ•°é‡
```

---

## æ€»ç»“

### æœ€å¸¸ç”¨çš„3ä¸ªå‘½ä»¤

```bash
# 1. æ—¥å¸¸è¿è¡Œï¼ˆå¤„ç†ä»Šå¤©çš„æ‰€æœ‰è‚¡ç¥¨ï¼‰
python run_batch_factor_processing.py

# 2. å¿«é€Ÿæµ‹è¯•ï¼ˆåªå¤„ç†10åªï¼‰
python run_batch_factor_processing.py --limit 10

# 3. é‡è¯•å¤±è´¥
python run_batch_factor_processing.py --mode retry
```

### è®°ä½è¿™ä¸ªè§„åˆ™

**å‚æ•° = é€‰é¡¹**

- ä¸å†™å‚æ•° = ä½¿ç”¨é»˜è®¤å€¼
- å†™äº†å‚æ•° = è¦†ç›–é»˜è®¤å€¼
- å‚æ•°å¯ä»¥è‡ªç”±ç»„åˆ
- å‚æ•°é¡ºåºä¸é‡è¦

---

ç°åœ¨ä½ å·²ç»æŒæ¡å‘½ä»¤è¡Œå‚æ•°äº†ï¼ğŸ‰
